# Everything Claude Code — 业务流程图

> 版本：1.0
> 日期：2026-02-07
> 项目版本：v1.4.1

---

## 1. 用户使用全景流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    用户使用 ECC 全景流程                           │
└─────────────────────────────────────────────────────────────────┘

  ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
  │  安装配置  │ ──→ │  日常开发  │ ──→ │  持续学习  │ ──→ │  知识演化  │
  └──────────┘     └──────────┘     └──────────┘     └──────────┘
       │                │                │                │
       ▼                ▼                ▼                ▼
  • 选择安装方式     • 计划功能         • 提取模式        • 聚类分析
  • 选择语言规则     • 编写测试         • 积累本能        • 生成技能
  • 配置钩子        • 实现功能         • 评估置信度       • 生成命令
  • 配置 MCP       • 代码审查         • 导入/导出        • 团队共享
                   • 验证部署
```

---

## 2. 安装配置流程

```
用户决定使用 ECC
        │
        ▼
  ┌─────────────┐
  │ 选择安装方式  │
  └──────┬──────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌────────┐
│插件市场 │ │手动安装 │
│安装     │ │        │
└───┬────┘ └───┬────┘
    │          │
    ▼          ▼
┌─────────────────────┐
│ 选择语言规则         │
│ ┌─────┐ ┌────────┐  │
│ │通用  │ │语言特定 │  │
│ │(必选)│ │(可选)  │  │
│ └─────┘ └────────┘  │
│   TS / Python / Go   │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 配置可选组件         │
│ • 钩子 (hooks.json) │
│ • MCP 服务器        │
│ • 包管理器偏好       │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 验证安装             │
│ /instinct-status    │
│ /verify             │
└─────────────────────┘
```

---

## 3. 功能开发完整流程

```
┌────────────────────────────────────────────────────────────────┐
│                    功能开发完整流程                                │
└────────────────────────────────────────────────────────────────┘

  用户: "我想实现 XX 功能"
        │
        ▼
  ┌──────────────┐
  │  /plan        │ ──→ planner 代理
  │  需求分析      │     分析代码库
  │  实施规划      │     生成实施计划
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐     ┌──────────────────────────────┐
  │  用户审批计划  │ ──→ │ 不满意 → 修改需求 → 重新规划  │
  └──────┬───────┘     └──────────────────────────────┘
         │ 确认
         ▼
  ┌──────────────┐
  │  /tdd         │ ──→ tdd-guide 代理
  │  RED 阶段     │     编写失败测试
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐
  │  GREEN 阶段   │     编写最少代码
  │  实现功能      │     使测试通过
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐
  │  REFACTOR     │     优化代码结构
  │  重构阶段      │     消除重复
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐
  │ /code-review  │ ──→ code-reviewer 代理
  │  代码审查      │     质量 + 安全审查
  └──────┬───────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
 通过      有问题
    │      ──→ 返回修改 ──→ 重新审查
    │
    ▼
  ┌──────────────┐
  │  /verify      │ ──→ 验证循环
  │  全面验证      │     类型检查 + Lint + 测试 + 覆盖率
  └──────┬───────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
 全部通过   有失败
    │      ──→ 自动修复 ──→ 重新验证 (最多5轮)
    │
    ▼
  ┌──────────────┐
  │  /checkpoint  │     保存验证状态
  │  状态保存      │
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐
  │  提交代码      │     Conventional Commits
  │  git commit   │
  └──────────────┘
```

---

## 4. 代码审查流程

```
  提交代码审查请求
        │
        ▼
  ┌──────────────────┐
  │  /code-review     │
  │  触发代码审查      │
  └────────┬─────────┘
           │
     ┌─────┴─────┐
     │           │
     ▼           ▼
┌─────────┐ ┌─────────────┐
│代码审查  │ │安全专项审查   │
│代理      │ │代理          │
└────┬────┘ └──────┬──────┘
     │             │
     ▼             ▼
┌─────────────────────────────┐
│  审查维度                     │
│  ├── 🔴 安全漏洞              │
│  ├── 🔴 功能缺陷              │
│  ├── 🟡 性能问题              │
│  ├── 🟡 可维护性              │
│  ├── 🟢 测试覆盖              │
│  └── 🟢 最佳实践              │
└──────────┬──────────────────┘
           │
           ▼
┌──────────────────┐
│  生成审查报告      │
│  CRITICAL / WARN  │
│  / GOOD           │
└────────┬─────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
 无严重问题  有严重问题
    │      ──→ 标记修复项 ──→ 开发者修复 ──→ 重新审查
    │
    ▼
  审查通过 ✅
```

---

## 5. 持续学习流程

```
┌────────────────────────────────────────────────────────────────┐
│                    持续学习流程                                   │
└────────────────────────────────────────────────────────────────┘

  日常开发会话
        │
        ▼
  ┌──────────────────┐
  │  模式观察          │ ← evaluate-session.js (自动)
  │  • 编码风格偏好    │ ← /learn (手动)
  │  • 测试策略选择    │
  │  • 工具使用习惯    │
  └────────┬─────────┘
           │
           ▼
  ┌──────────────────┐
  │  本能提取          │
  │  初始置信度: 0.3   │
  │  领域标签分类      │
  └────────┬─────────┘
           │
           ▼
  ┌──────────────────┐
  │  后续会话验证      │
  │  再次观察同一模式  │
  │  置信度 +0.1~0.2  │
  │  添加新证据        │
  └────────┬─────────┘
           │
           ▼
  ┌──────────────────┐
  │  本能成熟          │
  │  置信度 ≥ 0.7     │
  │  标记为可靠        │
  │  自动应用          │
  └────────┬─────────┘
           │
      ┌────┴────┐
      │         │
      ▼         ▼
┌──────────┐ ┌──────────┐
│个人使用   │ │团队共享   │
│自动应用   │ │导出/导入  │
└──────────┘ └──────────┘
```

---

## 6. 本能演化流程

```
  积累了大量本能
        │
        ▼
  ┌──────────────┐
  │  /evolve      │
  │  触发演化分析  │
  └──────┬───────┘
         │
         ▼
  ┌──────────────────┐
  │  聚类分析          │
  │  按领域分组        │
  │  按相似度聚合      │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  识别可合并的      │
  │  本能群            │
  │                    │
  │  例如:             │
  │  - 5个 code-style  │
  │    本能 → 1个技能   │
  │  - 3个 testing     │
  │    本能 → 1个命令   │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  生成草案          │
  │  • 新技能 SKILL.md │
  │  • 新命令          │
  │  • 新规则          │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  用户审批          │
  │  确认/修改/拒绝    │
  └────────┬─────────┘
         │ 确认
         ▼
  ┌──────────────────┐
  │  创建新组件        │
  │  写入文件系统      │
  │  立即可用          │
  └──────────────────┘
```

---

## 7. 多服务编排流程

```
  用户: "跨多个服务实现 XX"
        │
        ▼
  ┌──────────────────┐
  │  /multi-plan      │
  │  多服务任务分解    │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────────────────────┐
  │  分析服务依赖关系                   │
  │                                    │
  │  Service A ──→ Service B          │
  │       │              │            │
  │       └──→ Service C ←┘           │
  └──────────────┬───────────────────┘
                 │
                 ▼
  ┌──────────────────────────────────┐
  │  生成编排计划                       │
  │                                    │
  │  并行阶段 1:                       │
  │    • Agent 1 → Service A 修改     │
  │    • Agent 2 → Service C 修改     │
  │                                    │
  │  串行阶段 2:                       │
  │    • Agent 3 → Service B 修改     │
  │      (依赖 A 和 C 的变更)          │
  └──────────────┬───────────────────┘
                 │
                 ▼
  ┌──────────────────┐
  │  /multi-execute   │
  │  协调执行          │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────────────────────┐
  │  并行执行 Agent 1 + Agent 2      │
  │       │              │           │
  │       ▼              ▼           │
  │    完成            完成          │
  │       │              │           │
  │       └──────┬───────┘           │
  │              │                   │
  │              ▼                   │
  │  串行执行 Agent 3               │
  │              │                   │
  │              ▼                   │
  │           完成                   │
  └──────────────┬───────────────────┘
                 │
                 ▼
  ┌──────────────────┐
  │  集成验证          │
  │  跨服务测试        │
  └──────────────────┘
```

---

## 8. 会话生命周期流程

```
┌────────────────────────────────────────────────────────────────┐
│                    会话生命周期                                   │
└────────────────────────────────────────────────────────────────┘

  claude code 启动
        │
        ▼
  ┌──────────────────┐
  │  SessionStart     │ ← hooks/session-start.js
  │  ├── 检测包管理器 │
  │  ├── 加载上次上下文│
  │  └── 初始化环境   │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  会话运行中        │
  │  │                │
  │  ├── PreToolUse   │ ← 每次工具调用前检查
  │  │   ├── 安全检查 │
  │  │   └── 操作提醒 │
  │  │                │
  │  ├── PostToolUse  │ ← 每次工具调用后
  │  │   └── 日志记录 │
  │  │                │
  │  ├── /checkpoint  │ ← 手动保存检查点
  │  │                │
  │  └── PreCompact   │ ← 上下文即将压缩
  │      └── 保存状态 │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  会话结束          │ ← hooks/session-end.js
  │  ├── 保存会话状态 │
  │  ├── 提取学习模式 │ ← evaluate-session.js
  │  └── 更新本能     │
  └──────────────────┘
```

---

## 9. 验证循环流程

```
  /verify 触发
        │
        ▼
  ┌──────────────────┐
  │  步骤1: 类型检查   │ tsc / mypy / go vet
  └────────┬─────────┘
           │
      ┌────┴────┐
    通过      失败 → 修复类型错误 → 重试
      │
      ▼
  ┌──────────────────┐
  │  步骤2: Lint 检查  │ eslint / flake8 / golint
  └────────┬─────────┘
           │
      ┌────┴────┐
    通过      失败 → 修复 lint 问题 → 重试
      │
      ▼
  ┌──────────────────┐
  │  步骤3: 单元测试   │ jest / pytest / go test
  └────────┬─────────┘
           │
      ┌────┴────┐
    通过      失败 → 修复失败测试 → 重试
      │
      ▼
  ┌──────────────────┐
  │  步骤4: 集成测试   │ (如存在)
  └────────┬─────────┘
           │
      ┌────┴────┐
    通过      失败 → 修复 → 重试
      │
      ▼
  ┌──────────────────┐
  │  步骤5: 覆盖率    │ ≥ 80%?
  └────────┬─────────┘
           │
      ┌────┴────┐
    通过      不足 → 补充测试 → 重试
      │
      ▼
  ┌──────────────────┐
  │  ✅ 全部通过       │
  │  输出验证报告      │
  └──────────────────┘

  注: 每个步骤最多重试 5 次
      超过重试次数则输出失败报告
```

---

## 10. 构建错误修复流程

```
  构建失败
        │
        ▼
  ┌──────────────────┐
  │  /build-fix       │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  解析错误信息      │
  │  ├── 错误类型     │
  │  ├── 错误位置     │
  │  └── 上下文信息   │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  错误分类          │
  ├──────────────────┤
  │ 类型错误          │ → 修复类型定义/断言
  │ 缺少依赖          │ → 安装缺失包
  │ 语法错误          │ → 修复语法
  │ 配置错误          │ → 修正配置文件
  │ 版本不兼容        │ → 升级/降级依赖
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  应用修复          │
  └────────┬─────────┘
         │
         ▼
  ┌──────────────────┐
  │  重新构建          │
  └────────┬─────────┘
         │
    ┌────┴────┐
  成功      仍失败 → 回到"解析错误信息"
    │
    ▼
  ✅ 构建成功
```
