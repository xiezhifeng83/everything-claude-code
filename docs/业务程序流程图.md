# Everything Claude Code â€” ä¸šåŠ¡ç¨‹åºæµç¨‹å›¾

> ç‰ˆæœ¬ï¼š1.0
> æ—¥æœŸï¼š2026-02-07
> é¡¹ç›®ç‰ˆæœ¬ï¼šv1.4.1

æœ¬æ–‡æ¡£æè¿°ç³»ç»Ÿå†…éƒ¨ç¨‹åºæ‰§è¡Œçš„è¯¦ç»†æµç¨‹ï¼ŒåŒ…æ‹¬å‡½æ•°è°ƒç”¨é“¾ã€æ•°æ®æµè½¬å’Œæ§åˆ¶é€»è¾‘ã€‚

---

## 1. ç³»ç»Ÿå¯åŠ¨ç¨‹åºæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Code ä¼šè¯å¯åŠ¨æµç¨‹                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Claude Code CLI å¯åŠ¨
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  åŠ è½½ hooks.json          â”‚
  â”‚  è·¯å¾„: hooks/hooks.json   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è§¦å‘ SessionStart äº‹ä»¶   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æ‰§è¡Œ: node scripts/hooks/session-start.js        â”‚
  â”‚                                                    â”‚
  â”‚  session-start.js                                  â”‚
  â”‚  â”œâ”€â”€ require('./lib/utils.js')                    â”‚
  â”‚  â”‚   â””â”€â”€ getProjectRoot()                         â”‚
  â”‚  â”‚       â””â”€â”€ æŸ¥æ‰¾ .git ç›®å½• â†’ è¿”å›é¡¹ç›®æ ¹è·¯å¾„        â”‚
  â”‚  â”‚                                                 â”‚
  â”‚  â”œâ”€â”€ require('./lib/package-manager.js')           â”‚
  â”‚  â”‚   â””â”€â”€ detectPackageManager()                   â”‚
  â”‚  â”‚       â”œâ”€â”€ è¯»å– .claude/package-manager.json    â”‚
  â”‚  â”‚       â”‚   â””â”€â”€ å­˜åœ¨? â†’ è¿”å›é…ç½®çš„ PM             â”‚
  â”‚  â”‚       â”‚                                        â”‚
  â”‚  â”‚       â”œâ”€â”€ æ‰«æé”æ–‡ä»¶                            â”‚
  â”‚  â”‚       â”‚   â”œâ”€â”€ pnpm-lock.yaml â†’ return 'pnpm'  â”‚
  â”‚  â”‚       â”‚   â”œâ”€â”€ yarn.lock      â†’ return 'yarn'  â”‚
  â”‚  â”‚       â”‚   â”œâ”€â”€ bun.lockb      â†’ return 'bun'   â”‚
  â”‚  â”‚       â”‚   â””â”€â”€ package-lock   â†’ return 'npm'   â”‚
  â”‚  â”‚       â”‚                                        â”‚
  â”‚  â”‚       â””â”€â”€ é»˜è®¤ â†’ return 'npm'                  â”‚
  â”‚  â”‚                                                 â”‚
  â”‚  â”œâ”€â”€ require('./lib/session-manager.js')           â”‚
  â”‚  â”‚   â””â”€â”€ loadLastSession()                        â”‚
  â”‚  â”‚       â”œâ”€â”€ è¯»å– ~/.claude/sessions/             â”‚
  â”‚  â”‚       â”œâ”€â”€ æŒ‰æ—¶é—´æ’åº                            â”‚
  â”‚  â”‚       â”œâ”€â”€ åŠ è½½æœ€æ–°ä¼šè¯ä¸Šä¸‹æ–‡                     â”‚
  â”‚  â”‚       â””â”€â”€ è¿”å› { files, commands, instincts }  â”‚
  â”‚  â”‚                                                 â”‚
  â”‚  â””â”€â”€ è¾“å‡ºä¸Šä¸‹æ–‡æç¤ºåˆ° stdout                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  åŠ è½½ Rules               â”‚
  â”‚  â”œâ”€â”€ rules/common/*.md   â”‚ â† å§‹ç»ˆåŠ è½½
  â”‚  â””â”€â”€ rules/<lang>/*.md   â”‚ â† æŒ‰é¡¹ç›®ç±»å‹åŠ è½½
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  åŠ è½½ Plugin ç»„ä»¶         â”‚
  â”‚  (å¦‚é€šè¿‡æ’ä»¶å®‰è£…)          â”‚
  â”‚  â”œâ”€â”€ agents/             â”‚
  â”‚  â”œâ”€â”€ skills/             â”‚
  â”‚  â””â”€â”€ commands/           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ä¼šè¯å°±ç»ªï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. å‘½ä»¤æ‰§è¡Œç¨‹åºæµç¨‹

### 2.1 é€šç”¨å‘½ä»¤æ‰§è¡Œæµç¨‹

```
  ç”¨æˆ·è¾“å…¥: /<command-name> [args]
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Claude Code å‘½ä»¤è§£æå™¨                    â”‚
  â”‚                                            â”‚
  â”‚  1. åŒ¹é… commands/<command-name>.md       â”‚
  â”‚  2. è§£æ YAML frontmatter                 â”‚
  â”‚  3. åŠ è½½å‘½ä»¤æ¨¡æ¿ï¼ˆMarkdown bodyï¼‰           â”‚
  â”‚  4. æ³¨å…¥ç”¨æˆ·å‚æ•° [args]                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  å‘½ä»¤æ¨¡æ¿è§£æ                               â”‚
  â”‚                                            â”‚
  â”‚  æ£€æŸ¥æ¨¡æ¿ä¸­çš„æŒ‡ä»¤:                           â”‚
  â”‚  â”œâ”€â”€ "å§”æ‰˜ç»™ <agent>" â†’ è§¦å‘ä»£ç†å§”æ‰˜        â”‚
  â”‚  â”œâ”€â”€ "åŠ è½½æŠ€èƒ½ <skill>" â†’ åŠ è½½çŸ¥è¯†ä¸Šä¸‹æ–‡     â”‚
  â”‚  â””â”€â”€ "æ‰§è¡Œæ­¥éª¤ 1,2,3" â†’ é¡ºåºæ‰§è¡Œ           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æ‰§è¡Œå‘½ä»¤å®šä¹‰çš„å·¥ä½œæµ                        â”‚
  â”‚                                            â”‚
  â”‚  å¯¹äºæ¯ä¸ªæ­¥éª¤:                              â”‚
  â”‚  â”œâ”€â”€ PreToolUse é’©å­æ£€æŸ¥                    â”‚
  â”‚  â”œâ”€â”€ æ‰§è¡Œå·¥å…·è°ƒç”¨                           â”‚
  â”‚  â”œâ”€â”€ PostToolUse é’©å­å¤„ç†                   â”‚
  â”‚  â””â”€â”€ æ£€æŸ¥æ­¥éª¤ç»“æœï¼Œå†³å®šä¸‹ä¸€æ­¥               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 /plan å‘½ä»¤ç¨‹åºæµç¨‹

```
  ç”¨æˆ·: /plan å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  commands/plan.md åŠ è½½                               â”‚
  â”‚                                                      â”‚
  â”‚  æ¨¡æ¿æŒ‡ä»¤:                                           â”‚
  â”‚  1. å§”æ‰˜ç»™ planner ä»£ç†                              â”‚
  â”‚  2. ä¼ å…¥ç”¨æˆ·éœ€æ±‚: "å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½"                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  åˆ›å»º planner å­ä»£ç†å®ä¾‹                               â”‚
  â”‚                                                      â”‚
  â”‚  ä»£ç†é…ç½®:                                            â”‚
  â”‚  â”œâ”€â”€ tools: [Read, Grep, Glob]                      â”‚
  â”‚  â”œâ”€â”€ model: opus                                     â”‚
  â”‚  â””â”€â”€ æŒ‡ä»¤: agents/planner.md body                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  planner ä»£ç†æ‰§è¡Œ                                     â”‚
  â”‚                                                      â”‚
  â”‚  Step 1: Glob("**/*.{ts,tsx,js,jsx}")              â”‚
  â”‚          â†’ è·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨                           â”‚
  â”‚                                                      â”‚
  â”‚  Step 2: Read("package.json")                       â”‚
  â”‚          â†’ ç†è§£é¡¹ç›®ä¾èµ–å’Œç»“æ„                         â”‚
  â”‚                                                      â”‚
  â”‚  Step 3: Grep("auth|login|session")                 â”‚
  â”‚          â†’ æŸ¥æ‰¾å·²æœ‰è®¤è¯ç›¸å…³ä»£ç                        â”‚
  â”‚                                                      â”‚
  â”‚  Step 4: Read(ç›¸å…³æ–‡ä»¶)                              â”‚
  â”‚          â†’ æ·±å…¥ç†è§£ç°æœ‰å®ç°                           â”‚
  â”‚                                                      â”‚
  â”‚  Step 5: ç”Ÿæˆå®æ–½è®¡åˆ’                                 â”‚
  â”‚          â†’ æ­¥éª¤åŒ–æ–¹æ¡ˆ + é£é™©è¯„ä¼°                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¿”å›å®æ–½è®¡åˆ’ç»™ç”¨æˆ·                                    â”‚
  â”‚                                                      â”‚
  â”‚  ## å®æ–½è®¡åˆ’: ç”¨æˆ·ç™»å½•åŠŸèƒ½                             â”‚
  â”‚  ### æ­¥éª¤ 1: åˆ›å»ºè®¤è¯æœåŠ¡æ¨¡å—                          â”‚
  â”‚  ### æ­¥éª¤ 2: å®ç°ç™»å½• API ç«¯ç‚¹                        â”‚
  â”‚  ### æ­¥éª¤ 3: åˆ›å»ºç™»å½•è¡¨å•ç»„ä»¶                          â”‚
  â”‚  ### æ­¥éª¤ 4: æ·»åŠ è·¯ç”±ä¿æŠ¤                              â”‚
  â”‚  ### æ­¥éª¤ 5: ç¼–å†™æµ‹è¯•                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 /tdd å‘½ä»¤ç¨‹åºæµç¨‹

```
  ç”¨æˆ·: /tdd å®ç°å¯†ç å¼ºåº¦éªŒè¯å™¨
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  commands/tdd.md åŠ è½½                                  â”‚
  â”‚  â†’ åŠ è½½æŠ€èƒ½: skills/tdd-workflow/SKILL.md             â”‚
  â”‚  â†’ å§”æ‰˜ç»™: tdd-guide ä»£ç†                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  tdd-guide ä»£ç†: RED é˜¶æ®µ                              â”‚
  â”‚                                                        â”‚
  â”‚  1. Grep("password.*valid|strength")                  â”‚
  â”‚     â†’ æŸ¥æ‰¾å·²æœ‰å¯†ç éªŒè¯é€»è¾‘                              â”‚
  â”‚                                                        â”‚
  â”‚  2. ç¡®å®šæµ‹è¯•æ–‡ä»¶ä½ç½®                                    â”‚
  â”‚     â†’ tests/password-strength.test.ts                  â”‚
  â”‚                                                        â”‚
  â”‚  3. Write(æµ‹è¯•æ–‡ä»¶)                                    â”‚
  â”‚     â†’ describe('PasswordStrength', () => {             â”‚
  â”‚         it('should reject weak passwords', ...)        â”‚
  â”‚         it('should accept strong passwords', ...)      â”‚
  â”‚       })                                               â”‚
  â”‚                                                        â”‚
  â”‚  4. Bash("npm test -- password-strength")              â”‚
  â”‚     â†’ ç¡®è®¤æµ‹è¯•å¤±è´¥ âœ—                                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  tdd-guide ä»£ç†: GREEN é˜¶æ®µ                            â”‚
  â”‚                                                        â”‚
  â”‚  5. Write(å®ç°æ–‡ä»¶)                                    â”‚
  â”‚     â†’ src/password-strength.ts                         â”‚
  â”‚     â†’ export function validatePassword(pwd) { ... }    â”‚
  â”‚                                                        â”‚
  â”‚  6. Bash("npm test -- password-strength")              â”‚
  â”‚     â†’ ç¡®è®¤æµ‹è¯•é€šè¿‡ âœ“                                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  tdd-guide ä»£ç†: REFACTOR é˜¶æ®µ                         â”‚
  â”‚                                                        â”‚
  â”‚  7. Read(å®ç°æ–‡ä»¶) â†’ åˆ†æä»£ç è´¨é‡                       â”‚
  â”‚                                                        â”‚
  â”‚  8. Edit(å®ç°æ–‡ä»¶) â†’ ä¼˜åŒ–ç»“æ„/å‘½å                      â”‚
  â”‚                                                        â”‚
  â”‚  9. Bash("npm test -- password-strength")              â”‚
  â”‚     â†’ ç¡®è®¤é‡æ„åä»é€šè¿‡ âœ“                                â”‚
  â”‚                                                        â”‚
  â”‚  10. Bash("npm test -- --coverage")                   â”‚
  â”‚      â†’ ç¡®è®¤è¦†ç›–ç‡ â‰¥ 80%                                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. é’©å­ç³»ç»Ÿç¨‹åºæµç¨‹

### 3.1 PreToolUse é’©å­æ‰§è¡Œæµç¨‹

```
  ä¸»ä»£ç†å‡†å¤‡è°ƒç”¨å·¥å…·
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Claude Code Runtime                      â”‚
  â”‚                                            â”‚
  â”‚  1. è¯»å– hooks.json                        â”‚
  â”‚  2. ç­›é€‰ PreToolUse é’©å­åˆ—è¡¨               â”‚
  â”‚  3. å¯¹æ¯ä¸ªé’©å­:                             â”‚
  â”‚     â”œâ”€â”€ æ£€æŸ¥ matcher æ˜¯å¦åŒ¹é…å½“å‰å·¥å…·       â”‚
  â”‚     â”‚   matcher: "Bash" ?== å½“å‰å·¥å…·å      â”‚
  â”‚     â”‚                                       â”‚
  â”‚     â”œâ”€â”€ åŒ¹é… â†’ æ‰§è¡Œ command                 â”‚
  â”‚     â”‚   â””â”€â”€ node scripts/hooks/<script>.js  â”‚
  â”‚     â”‚       â”‚                                â”‚
  â”‚     â”‚       â”œâ”€â”€ è¿”å› stdout ä¸ºç©º â†’ å…è®¸ç»§ç»­  â”‚
  â”‚     â”‚       â”œâ”€â”€ è¿”å› "BLOCK" â†’ é˜»æ­¢æ‰§è¡Œ     â”‚
  â”‚     â”‚       â””â”€â”€ è¿”å›æç¤ºä¿¡æ¯ â†’ é™„åŠ åˆ°ä¸Šä¸‹æ–‡  â”‚
  â”‚     â”‚                                       â”‚
  â”‚     â””â”€â”€ ä¸åŒ¹é… â†’ è·³è¿‡                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
             â”‚               â”‚
           å…è®¸             é˜»æ­¢
             â”‚               â”‚
             â–¼               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æ‰§è¡Œå·¥å…·è°ƒç”¨  â”‚  â”‚  å–æ¶ˆæ“ä½œ     â”‚
  â”‚  (Bash/Edit  â”‚  â”‚  è¿”å›é˜»æ­¢åŸå›   â”‚
  â”‚   /Write...) â”‚  â”‚  ç»™ä¸»ä»£ç†     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 check-console-log.js é’©å­è¯¦ç»†æµç¨‹

```
  PreToolUse(Write/Edit) è§¦å‘
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  check-console-log.js                     â”‚
  â”‚                                            â”‚
  â”‚  // ä» stdin è·å–å·¥å…·è°ƒç”¨å‚æ•°               â”‚
  â”‚  const input = JSON.parse(stdin);         â”‚
  â”‚                                            â”‚
  â”‚  // è·å–ç›®æ ‡æ–‡ä»¶è·¯å¾„                        â”‚
  â”‚  const filePath = input.file_path;        â”‚
  â”‚                                            â”‚
  â”‚  // æ£€æŸ¥æ˜¯å¦ä¸º JS/TS æ–‡ä»¶                   â”‚
  â”‚  if (!/\.(js|ts|jsx|tsx)$/.test(filePath)) â”‚
  â”‚    process.exit(0); // éç›®æ ‡æ–‡ä»¶ï¼Œè·³è¿‡     â”‚
  â”‚                                            â”‚
  â”‚  // æ£€æŸ¥æ˜¯å¦ä¸ºæµ‹è¯•æ–‡ä»¶                       â”‚
  â”‚  if (/\.(test|spec)\.(js|ts)/.test(filePath))â”‚
  â”‚    process.exit(0); // æµ‹è¯•æ–‡ä»¶å¯ä¿ç•™        â”‚
  â”‚                                            â”‚
  â”‚  // æ£€æŸ¥æ–°å†…å®¹ä¸­æ˜¯å¦åŒ…å« console.log        â”‚
  â”‚  const content = input.new_string          â”‚
  â”‚                || input.content;           â”‚
  â”‚                                            â”‚
  â”‚  if (/console\.log/.test(content)) {       â”‚
  â”‚    // è¾“å‡ºè­¦å‘Šï¼ˆä¸é˜»æ­¢ï¼Œä»…æé†’ï¼‰             â”‚
  â”‚    console.log("âš ï¸ æ£€æµ‹åˆ° console.log");    â”‚
  â”‚    console.log("å»ºè®®ä½¿ç”¨ä¸“ç”¨ logger");       â”‚
  â”‚  }                                         â”‚
  â”‚                                            â”‚
  â”‚  process.exit(0);                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 suggest-compact.js é’©å­è¯¦ç»†æµç¨‹

```
  PreToolUse è§¦å‘ï¼ˆæ¯æ¬¡å·¥å…·è°ƒç”¨å‰ï¼‰
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  suggest-compact.js                       â”‚
  â”‚                                            â”‚
  â”‚  // è·å–å½“å‰ä¼šè¯ç»Ÿè®¡                        â”‚
  â”‚  const sessionInfo = getSessionInfo();    â”‚
  â”‚                                            â”‚
  â”‚  // ä¼°ç®— Token ä½¿ç”¨é‡                      â”‚
  â”‚  const usage = estimateTokenUsage();      â”‚
  â”‚                                            â”‚
  â”‚  // è®¡ç®—ä½¿ç”¨ç‡                              â”‚
  â”‚  const ratio = usage / MAX_CONTEXT;       â”‚
  â”‚                                            â”‚
  â”‚  if (ratio < 0.5) {                       â”‚
  â”‚    process.exit(0);  // æ— éœ€æé†’           â”‚
  â”‚  }                                         â”‚
  â”‚                                            â”‚
  â”‚  if (ratio < 0.7) {                       â”‚
  â”‚    console.log("ğŸ’¡ ä¸Šä¸‹æ–‡ä½¿ç”¨è¶…50%");       â”‚
  â”‚    console.log("å¯è€ƒè™‘ /checkpoint ä¿å­˜");  â”‚
  â”‚  } else if (ratio < 0.85) {               â”‚
  â”‚    console.log("âš ï¸ ä¸Šä¸‹æ–‡ä½¿ç”¨è¶…70%");       â”‚
  â”‚    console.log("å»ºè®®å°½å¿«å‹ç¼©ä¸Šä¸‹æ–‡");       â”‚
  â”‚  } else {                                  â”‚
  â”‚    console.log("ğŸš¨ ä¸Šä¸‹æ–‡å³å°†è€—å°½!");       â”‚
  â”‚    console.log("è¯·ç«‹å³æ‰§è¡Œ /compact");      â”‚
  â”‚  }                                         â”‚
  â”‚                                            â”‚
  â”‚  process.exit(0);                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. åŒ…ç®¡ç†å™¨æ£€æµ‹ç¨‹åºæµç¨‹

```
  éœ€è¦æ‰§è¡ŒåŒ…ç®¡ç†å‘½ä»¤
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  package-manager.js :: detectPackageManager()         â”‚
  â”‚                                                        â”‚
  â”‚  // ä¼˜å…ˆçº§ 1: é¡¹ç›®çº§é…ç½®                               â”‚
  â”‚  const projectConfig =                                â”‚
  â”‚    readJsonFile('.claude/package-manager.json');       â”‚
  â”‚                                                        â”‚
  â”‚  if (projectConfig?.packageManager) {                 â”‚
  â”‚    return projectConfig.packageManager;               â”‚
  â”‚    // â†’ 'pnpm' | 'yarn' | 'bun' | 'npm'             â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // ä¼˜å…ˆçº§ 2: é”æ–‡ä»¶æ£€æµ‹                               â”‚
  â”‚  const root = getProjectRoot();                       â”‚
  â”‚                                                        â”‚
  â”‚  if (exists(root + '/pnpm-lock.yaml'))                â”‚
  â”‚    return 'pnpm';                                     â”‚
  â”‚                                                        â”‚
  â”‚  if (exists(root + '/yarn.lock'))                     â”‚
  â”‚    return 'yarn';                                     â”‚
  â”‚                                                        â”‚
  â”‚  if (exists(root + '/bun.lockb'))                     â”‚
  â”‚    return 'bun';                                      â”‚
  â”‚                                                        â”‚
  â”‚  if (exists(root + '/package-lock.json'))             â”‚
  â”‚    return 'npm';                                      â”‚
  â”‚                                                        â”‚
  â”‚  // ä¼˜å…ˆçº§ 3: å…¨å±€é…ç½®                                 â”‚
  â”‚  const globalConfig =                                 â”‚
  â”‚    readJsonFile('~/.claude/package-manager.json');     â”‚
  â”‚                                                        â”‚
  â”‚  if (globalConfig?.default) {                         â”‚
  â”‚    return globalConfig.default;                       â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // ä¼˜å…ˆçº§ 4: é»˜è®¤å€¼                                   â”‚
  â”‚  return 'npm';                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  package-manager.js :: getCommand(pm, action, args)   â”‚
  â”‚                                                        â”‚
  â”‚  å‘½ä»¤æ˜ å°„è¡¨:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚ action   â”‚ npm        â”‚ pnpm   â”‚ yarn   â”‚ bun    â”‚ â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
  â”‚  â”‚ install  â”‚ npm i      â”‚ pnpm i â”‚ yarn   â”‚ bun i  â”‚ â”‚
  â”‚  â”‚ add      â”‚ npm i <p>  â”‚ pnpm   â”‚ yarn   â”‚ bun    â”‚ â”‚
  â”‚  â”‚          â”‚            â”‚ add <p>â”‚ add <p>â”‚ add <p>â”‚ â”‚
  â”‚  â”‚ run      â”‚ npm run <s>â”‚ pnpm   â”‚ yarn   â”‚ bun    â”‚ â”‚
  â”‚  â”‚          â”‚            â”‚ <s>    â”‚ <s>    â”‚ run <s>â”‚ â”‚
  â”‚  â”‚ test     â”‚ npm test   â”‚ pnpm   â”‚ yarn   â”‚ bun    â”‚ â”‚
  â”‚  â”‚          â”‚            â”‚ test   â”‚ test   â”‚ test   â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. CI éªŒè¯ç¨‹åºæµç¨‹

### 5.1 validate-agents.js è¯¦ç»†æµç¨‹

```
  CI è§¦å‘ / æ‰‹åŠ¨è¿è¡Œ
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  validate-agents.js                                    â”‚
  â”‚                                                        â”‚
  â”‚  // 1. æ‰«æä»£ç†æ–‡ä»¶                                    â”‚
  â”‚  const agentFiles = glob('agents/*.md');               â”‚
  â”‚                                                        â”‚
  â”‚  const errors = [];                                    â”‚
  â”‚  const validTools = ['Read','Grep','Glob',            â”‚
  â”‚                      'Bash','Write','Edit'];           â”‚
  â”‚  const validModels = ['opus', 'haiku'];               â”‚
  â”‚                                                        â”‚
  â”‚  for (const file of agentFiles) {                     â”‚
  â”‚    // 2. è¯»å–å¹¶è§£æ frontmatter                        â”‚
  â”‚    const content = readFile(file);                    â”‚
  â”‚    const { data, body } = parseFrontmatter(content);  â”‚
  â”‚                                                        â”‚
  â”‚    // 3. å¿…å¡«å­—æ®µæ£€æŸ¥                                   â”‚
  â”‚    if (!data.name)                                    â”‚
  â”‚      errors.push(`${file}: ç¼ºå°‘ name`);              â”‚
  â”‚    if (!data.description)                             â”‚
  â”‚      errors.push(`${file}: ç¼ºå°‘ description`);       â”‚
  â”‚    if (!data.tools || !Array.isArray(data.tools))     â”‚
  â”‚      errors.push(`${file}: ç¼ºå°‘ tools æ•°ç»„`);        â”‚
  â”‚                                                        â”‚
  â”‚    // 4. å·¥å…·åˆæ³•æ€§æ£€æŸ¥                                 â”‚
  â”‚    if (data.tools) {                                  â”‚
  â”‚      for (const tool of data.tools) {                 â”‚
  â”‚        if (!validTools.includes(tool))                â”‚
  â”‚          errors.push(                                 â”‚
  â”‚            `${file}: æ— æ•ˆå·¥å…· "${tool}"`);            â”‚
  â”‚      }                                                â”‚
  â”‚    }                                                  â”‚
  â”‚                                                        â”‚
  â”‚    // 5. æ¨¡å‹åˆæ³•æ€§æ£€æŸ¥                                 â”‚
  â”‚    if (data.model && !validModels.includes(data.model))â”‚
  â”‚      errors.push(                                     â”‚
  â”‚        `${file}: æ— æ•ˆæ¨¡å‹ "${data.model}"`);          â”‚
  â”‚                                                        â”‚
  â”‚    // 6. Body éç©ºæ£€æŸ¥                                  â”‚
  â”‚    if (!body.trim())                                  â”‚
  â”‚      errors.push(`${file}: æŒ‡ä»¤å†…å®¹ä¸ºç©º`);            â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // 7. è¾“å‡ºç»“æœ                                        â”‚
  â”‚  if (errors.length > 0) {                             â”‚
  â”‚    errors.forEach(e => console.error(`  âœ— ${e}`));    â”‚
  â”‚    process.exit(1);                                   â”‚
  â”‚  }                                                     â”‚
  â”‚  console.log(`âœ“ ${agentFiles.length} ä¸ªä»£ç†éªŒè¯é€šè¿‡`); â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ä¼šè¯æŒä¹…åŒ–ç¨‹åºæµç¨‹

### 6.1 ä¼šè¯ä¿å­˜æµç¨‹

```
  ä¼šè¯ç»“æŸ / PreCompact è§¦å‘
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  session-manager.js :: saveSession(sessionData)       â”‚
  â”‚                                                        â”‚
  â”‚  // 1. æ„å»ºä¼šè¯å¯¹è±¡                                    â”‚
  â”‚  const session = {                                    â”‚
  â”‚    id: generateUUID(),                                â”‚
  â”‚    timestamp: Date.now(),                             â”‚
  â”‚    context: {                                         â”‚
  â”‚      workingFiles: getActiveFiles(),                  â”‚
  â”‚      recentCommands: getCommandHistory(),             â”‚
  â”‚      instincts: getActiveInstincts(),                 â”‚
  â”‚      checkpoints: getCheckpoints()                    â”‚
  â”‚    }                                                  â”‚
  â”‚  };                                                    â”‚
  â”‚                                                        â”‚
  â”‚  // 2. ç¡®ä¿ç›®å½•å­˜åœ¨                                    â”‚
  â”‚  ensureDir('~/.claude/sessions/');                     â”‚
  â”‚                                                        â”‚
  â”‚  // 3. å†™å…¥ä¼šè¯æ–‡ä»¶                                    â”‚
  â”‚  const filename = `session-${session.id}.json`;       â”‚
  â”‚  writeJsonFile(                                       â”‚
  â”‚    `~/.claude/sessions/${filename}`,                  â”‚
  â”‚    session                                            â”‚
  â”‚  );                                                    â”‚
  â”‚                                                        â”‚
  â”‚  // 4. æ¸…ç†æ—§ä¼šè¯ï¼ˆä¿ç•™æœ€è¿‘ N ä¸ªï¼‰                     â”‚
  â”‚  pruneOldSessions(MAX_SESSIONS);                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ä¼šè¯æ¢å¤æµç¨‹

```
  SessionStart é’©å­è§¦å‘
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  session-manager.js :: loadLastSession()              â”‚
  â”‚                                                        â”‚
  â”‚  // 1. åˆ—å‡ºæ‰€æœ‰ä¼šè¯æ–‡ä»¶                                â”‚
  â”‚  const files = glob('~/.claude/sessions/session-*.json');â”‚
  â”‚                                                        â”‚
  â”‚  if (files.length === 0) return null;                 â”‚
  â”‚                                                        â”‚
  â”‚  // 2. æŒ‰ä¿®æ”¹æ—¶é—´æ’åº                                  â”‚
  â”‚  files.sort((a, b) => mtime(b) - mtime(a));          â”‚
  â”‚                                                        â”‚
  â”‚  // 3. è¯»å–æœ€æ–°ä¼šè¯                                    â”‚
  â”‚  const latest = readJsonFile(files[0]);               â”‚
  â”‚                                                        â”‚
  â”‚  // 4. éªŒè¯ä¼šè¯æ•°æ®å®Œæ•´æ€§                              â”‚
  â”‚  if (!latest?.context) return null;                   â”‚
  â”‚                                                        â”‚
  â”‚  // 5. æ£€æŸ¥æ˜¯å¦å±äºå½“å‰é¡¹ç›®                             â”‚
  â”‚  const projectRoot = getProjectRoot();                â”‚
  â”‚  if (latest.projectRoot !== projectRoot)              â”‚
  â”‚    return null; // ä¸åŒé¡¹ç›®çš„ä¼šè¯                       â”‚
  â”‚                                                        â”‚
  â”‚  // 6. è¿”å›ä¸Šä¸‹æ–‡                                      â”‚
  â”‚  return {                                             â”‚
  â”‚    files: latest.context.workingFiles,                â”‚
  â”‚    commands: latest.context.recentCommands,           â”‚
  â”‚    instincts: latest.context.instincts               â”‚
  â”‚  };                                                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. æœ¬èƒ½æå–ç¨‹åºæµç¨‹

```
  /learn å‘½ä»¤ æˆ– evaluate-session.js è‡ªåŠ¨è§¦å‘
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  evaluate-session.js                                   â”‚
  â”‚                                                        â”‚
  â”‚  // 1. è·å–å½“å‰ä¼šè¯äº¤äº’å†å²                             â”‚
  â”‚  const history = getSessionHistory();                 â”‚
  â”‚                                                        â”‚
  â”‚  // 2. åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼                                 â”‚
  â”‚  const patterns = analyzePatterns(history);           â”‚
  â”‚  // patterns ç¤ºä¾‹:                                     â”‚
  â”‚  // - ç”¨æˆ·æ€»æ˜¯ä½¿ç”¨ zod åšéªŒè¯                          â”‚
  â”‚  // - ç”¨æˆ·åå¥½ functional é£æ ¼                         â”‚
  â”‚  // - ç”¨æˆ·æµ‹è¯•å‘½åä½¿ç”¨ should_xxx                      â”‚
  â”‚                                                        â”‚
  â”‚  // 3. ä¸ç°æœ‰æœ¬èƒ½æ¯”å¯¹                                   â”‚
  â”‚  const existingInstincts = loadInstincts();           â”‚
  â”‚                                                        â”‚
  â”‚  for (const pattern of patterns) {                    â”‚
  â”‚    const match = findMatchingInstinct(                â”‚
  â”‚      existingInstincts, pattern                       â”‚
  â”‚    );                                                  â”‚
  â”‚                                                        â”‚
  â”‚    if (match) {                                       â”‚
  â”‚      // 4a. å·²æœ‰æœ¬èƒ½ â†’ å¢åŠ ç½®ä¿¡åº¦                      â”‚
  â”‚      match.confidence = Math.min(                     â”‚
  â”‚        0.9,                                           â”‚
  â”‚        match.confidence + 0.1                         â”‚
  â”‚      );                                               â”‚
  â”‚      match.evidence.push({                            â”‚
  â”‚        source: sessionId,                             â”‚
  â”‚        context: pattern.context                       â”‚
  â”‚      });                                              â”‚
  â”‚      match.updated_at = new Date();                   â”‚
  â”‚    } else {                                           â”‚
  â”‚      // 4b. æ–°æœ¬èƒ½ â†’ åˆ›å»º                              â”‚
  â”‚      existingInstincts.push({                         â”‚
  â”‚        id: generateId(),                              â”‚
  â”‚        pattern: pattern.description,                  â”‚
  â”‚        confidence: 0.3,                               â”‚
  â”‚        domain: pattern.domain,                        â”‚
  â”‚        evidence: [{                                   â”‚
  â”‚          source: sessionId,                           â”‚
  â”‚          context: pattern.context                     â”‚
  â”‚        }],                                            â”‚
  â”‚        created_at: new Date(),                        â”‚
  â”‚        updated_at: new Date()                         â”‚
  â”‚      });                                              â”‚
  â”‚    }                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // 5. ä¿å­˜æ›´æ–°åçš„æœ¬èƒ½åº“                               â”‚
  â”‚  saveInstincts(existingInstincts);                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. æ’ä»¶å®‰è£…ç¨‹åºæµç¨‹

```
  ç”¨æˆ·: /plugin install everything-claude-code
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Claude Code Plugin Runtime                            â”‚
  â”‚                                                        â”‚
  â”‚  // 1. ä» marketplace è·å–æ’ä»¶ä¿¡æ¯                      â”‚
  â”‚  const pluginInfo = fetchMarketplace(                  â”‚
  â”‚    'everything-claude-code'                            â”‚
  â”‚  );                                                    â”‚
  â”‚                                                        â”‚
  â”‚  // 2. ä¸‹è½½æ’ä»¶åŒ…                                      â”‚
  â”‚  const package = download(pluginInfo.url);             â”‚
  â”‚                                                        â”‚
  â”‚  // 3. è§£æ plugin.json                                â”‚
  â”‚  const manifest = readJson(                           â”‚
  â”‚    package + '/.claude-plugin/plugin.json'            â”‚
  â”‚  );                                                    â”‚
  â”‚                                                        â”‚
  â”‚  // 4. å®‰è£…ä»£ç†                                        â”‚
  â”‚  for (const agent of manifest.agents) {               â”‚
  â”‚    copy(agent.path, '~/.claude/agents/');             â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // 5. å®‰è£…æŠ€èƒ½                                        â”‚
  â”‚  for (const skill of manifest.skills) {               â”‚
  â”‚    copyDir(skill.path, '~/.claude/skills/');          â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // 6. æ³¨æ„: è§„åˆ™å’Œé’©å­ä¸é€šè¿‡æ’ä»¶å®‰è£…                   â”‚
  â”‚  //    éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶                                 â”‚
  â”‚  console.log('âš ï¸ è¯·æ‰‹åŠ¨å®‰è£… rules/ å’Œ hooks/');       â”‚
  â”‚                                                        â”‚
  â”‚  // 7. éªŒè¯å®‰è£…                                        â”‚
  â”‚  validateInstallation();                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. è·¨å¹³å°è·¯å¾„å¤„ç†ç¨‹åºæµç¨‹

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  utils.js :: getProjectRoot()                         â”‚
  â”‚                                                        â”‚
  â”‚  function getProjectRoot() {                          â”‚
  â”‚    let current = process.cwd();                       â”‚
  â”‚                                                        â”‚
  â”‚    while (true) {                                     â”‚
  â”‚      // æ£€æŸ¥ .git ç›®å½•                                 â”‚
  â”‚      const gitDir = path.join(current, '.git');       â”‚
  â”‚      if (fs.existsSync(gitDir)) {                     â”‚
  â”‚        return current;                                â”‚
  â”‚      }                                                â”‚
  â”‚                                                        â”‚
  â”‚      // ä¸Šç§»ä¸€å±‚                                       â”‚
  â”‚      const parent = path.dirname(current);            â”‚
  â”‚      if (parent === current) {                        â”‚
  â”‚        // å·²åˆ°æ ¹ç›®å½•                                   â”‚
  â”‚        return process.cwd(); // å›é€€åˆ° CWD            â”‚
  â”‚      }                                                â”‚
  â”‚      current = parent;                                â”‚
  â”‚    }                                                   â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // Windows: D:\GitHub\project                        â”‚
  â”‚  // macOS:   /Users/dev/project                       â”‚
  â”‚  // Linux:   /home/dev/project                        â”‚
  â”‚  // ç»Ÿä¸€ä½¿ç”¨ path.join/resolve å¤„ç†                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. æµ‹è¯•æ‰§è¡Œç¨‹åºæµç¨‹

```
  node tests/run-all.js
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  run-all.js                                            â”‚
  â”‚                                                        â”‚
  â”‚  // 1. å‘ç°æ‰€æœ‰æµ‹è¯•æ–‡ä»¶                                 â”‚
  â”‚  const testFiles = [                                  â”‚
  â”‚    'tests/lib/utils.test.js',                         â”‚
  â”‚    'tests/lib/package-manager.test.js',               â”‚
  â”‚    'tests/hooks/hooks.test.js',                       â”‚
  â”‚    'tests/integration/hooks.test.js'                  â”‚
  â”‚  ];                                                    â”‚
  â”‚                                                        â”‚
  â”‚  let passed = 0, failed = 0;                          â”‚
  â”‚                                                        â”‚
  â”‚  // 2. é€ä¸ªæ‰§è¡Œæµ‹è¯•                                    â”‚
  â”‚  for (const file of testFiles) {                      â”‚
  â”‚    try {                                              â”‚
  â”‚      require(file);                                   â”‚
  â”‚      // æ¯ä¸ªæµ‹è¯•æ–‡ä»¶å†…éƒ¨ä½¿ç”¨ assert æ–­è¨€                â”‚
  â”‚      passed++;                                        â”‚
  â”‚      console.log(`âœ“ ${file}`);                        â”‚
  â”‚    } catch (error) {                                  â”‚
  â”‚      failed++;                                        â”‚
  â”‚      console.error(`âœ— ${file}: ${error.message}`);    â”‚
  â”‚    }                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // 3. è¾“å‡ºæ€»ç»“                                        â”‚
  â”‚  console.log(`\nç»“æœ: ${passed} é€šè¿‡, ${failed} å¤±è´¥`);â”‚
  â”‚                                                        â”‚
  â”‚  if (failed > 0) process.exit(1);                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
