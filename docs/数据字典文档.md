# Everything Claude Code — 数据字典文档

> 版本：1.0
> 日期：2026-02-07
> 项目版本：v1.4.1

---

## 1. 概述

本文档定义 Everything Claude Code 中所有数据结构、配置格式和字段规范，作为开发和维护的权威参考。

---

## 2. 配置文件格式

### 2.1 Markdown + YAML Frontmatter 格式

ECC 中的代理、命令、技能、规则均使用此格式：

```
---
<YAML frontmatter 字段>
---

<Markdown 正文内容>
```

**Frontmatter 解析规则：**
- 文件必须以 `---` 开头
- 第二个 `---` 结束 frontmatter 区域
- YAML 语法遵循 YAML 1.2 规范
- 正文部分为标准 Markdown

---

## 3. 代理数据字典

### 3.1 代理 Frontmatter 字段

**文件位置：** `agents/<name>.md`

| 字段名 | 数据类型 | 必填 | 默认值 | 允许值 | 说明 |
|--------|---------|------|--------|--------|------|
| `name` | string | ✅ | — | kebab-case 格式 | 代理唯一标识符 |
| `description` | string | ✅ | — | 任意文本 | 代理职责描述 |
| `tools` | string[] | ✅ | — | 见工具枚举表 | 允许使用的工具列表 |
| `model` | string | ❌ | `opus` | `opus`, `haiku` | 使用的 AI 模型 |

### 3.2 工具枚举表

| 工具名 | 说明 | 权限级别 |
|--------|------|---------|
| `Read` | 读取文件内容 | 只读 |
| `Grep` | 搜索文件内容 | 只读 |
| `Glob` | 文件模式匹配 | 只读 |
| `Bash` | 执行 Shell 命令 | 读写 + 执行 |
| `Write` | 创建/覆盖文件 | 写入 |
| `Edit` | 编辑现有文件 | 写入 |

### 3.3 代理清单

| name | tools | model | 文件 |
|------|-------|-------|------|
| `planner` | Read, Grep, Glob | opus | `agents/planner.md` |
| `architect` | Read, Grep, Glob | opus | `agents/architect.md` |
| `code-reviewer` | Read, Grep, Glob, Bash | opus | `agents/code-reviewer.md` |
| `security-reviewer` | Read, Grep, Glob | opus | `agents/security-reviewer.md` |
| `tdd-guide` | Read, Grep, Glob, Bash, Write, Edit | opus | `agents/tdd-guide.md` |
| `build-error-resolver` | Read, Grep, Glob, Bash, Write, Edit | opus | `agents/build-error-resolver.md` |
| `e2e-runner` | Read, Grep, Glob, Bash, Write, Edit | opus | `agents/e2e-runner.md` |
| `refactor-cleaner` | Read, Grep, Glob, Bash, Write, Edit | opus | `agents/refactor-cleaner.md` |
| `doc-updater` | Read, Grep, Glob, Write, Edit | opus | `agents/doc-updater.md` |
| `go-reviewer` | Read, Grep, Glob, Bash | opus | `agents/go-reviewer.md` |
| `go-build-resolver` | Read, Grep, Glob, Bash, Write, Edit | opus | `agents/go-build-resolver.md` |
| `python-reviewer` | Read, Grep, Glob, Bash | opus | `agents/python-reviewer.md` |
| `database-reviewer` | Read, Grep, Glob, Bash | opus | `agents/database-reviewer.md` |

---

## 4. 命令数据字典

### 4.1 命令 Frontmatter 字段

**文件位置：** `commands/<name>.md`

| 字段名 | 数据类型 | 必填 | 默认值 | 说明 |
|--------|---------|------|--------|------|
| `description` | string | ✅ | — | 命令功能描述，用于帮助和自动发现 |

### 4.2 命令清单

| 命令名 | 触发方式 | 关联代理 | 关联技能 | 文件 |
|--------|---------|---------|---------|------|
| plan | `/plan` | planner | — | `commands/plan.md` |
| tdd | `/tdd` | tdd-guide | tdd-workflow | `commands/tdd.md` |
| code-review | `/code-review` | code-reviewer | security-review | `commands/code-review.md` |
| build-fix | `/build-fix` | build-error-resolver | — | `commands/build-fix.md` |
| e2e | `/e2e` | e2e-runner | — | `commands/e2e.md` |
| refactor-clean | `/refactor-clean` | refactor-cleaner | — | `commands/refactor-clean.md` |
| verify | `/verify` | — | verification-loop | `commands/verify.md` |
| checkpoint | `/checkpoint` | — | — | `commands/checkpoint.md` |
| eval | `/eval` | — | eval-harness | `commands/eval.md` |
| learn | `/learn` | — | continuous-learning | `commands/learn.md` |
| skill-create | `/skill-create` | — | — | `commands/skill-create.md` |
| instinct-status | `/instinct-status` | — | continuous-learning-v2 | `commands/instinct-status.md` |
| instinct-import | `/instinct-import` | — | continuous-learning-v2 | `commands/instinct-import.md` |
| instinct-export | `/instinct-export` | — | continuous-learning-v2 | `commands/instinct-export.md` |
| evolve | `/evolve` | — | continuous-learning-v2 | `commands/evolve.md` |
| go-review | `/go-review` | go-reviewer | golang-patterns | `commands/go-review.md` |
| go-test | `/go-test` | tdd-guide | golang-testing | `commands/go-test.md` |
| go-build | `/go-build` | go-build-resolver | — | `commands/go-build.md` |
| python-review | `/python-review` | python-reviewer | python-patterns | `commands/python-review.md` |
| pm2 | `/pm2` | — | — | `commands/pm2.md` |
| multi-plan | `/multi-plan` | planner | — | `commands/multi-plan.md` |
| multi-execute | `/multi-execute` | — | — | `commands/multi-execute.md` |
| multi-backend | `/multi-backend` | — | backend-patterns | `commands/multi-backend.md` |
| multi-frontend | `/multi-frontend` | — | frontend-patterns | `commands/multi-frontend.md` |
| multi-workflow | `/multi-workflow` | — | — | `commands/multi-workflow.md` |
| sessions | `/sessions` | — | — | `commands/sessions.md` |
| setup-pm | `/setup-pm` | — | — | `commands/setup-pm.md` |
| test-coverage | `/test-coverage` | — | — | `commands/test-coverage.md` |
| update-docs | `/update-docs` | doc-updater | — | `commands/update-docs.md` |
| update-codemaps | `/update-codemaps` | — | — | `commands/update-codemaps.md` |
| orchestrate | `/orchestrate` | — | — | `commands/orchestrate.md` |

---

## 5. 技能数据字典

### 5.1 技能 Frontmatter 字段

**文件位置：** `skills/<name>/SKILL.md`

| 字段名 | 数据类型 | 必填 | 默认值 | 说明 |
|--------|---------|------|--------|------|
| `name` | string | ✅ | — | 技能标识符 |
| `description` | string | ✅ | — | 技能功能描述 |
| `version` | string | ❌ | — | 语义化版本号 |

### 5.2 技能分类清单

#### 工作流技能

| name | 描述 | 目录 |
|------|------|------|
| `tdd-workflow` | RED→GREEN→REFACTOR 方法论 | `skills/tdd-workflow/` |
| `verification-loop` | 持续验证框架 | `skills/verification-loop/` |
| `eval-harness` | 评估框架 | `skills/eval-harness/` |
| `strategic-compact` | 策略性上下文压缩 | `skills/strategic-compact/` |

#### 编码标准技能

| name | 描述 | 目录 |
|------|------|------|
| `coding-standards` | 通用编码标准 | `skills/coding-standards/` |
| `backend-patterns` | 后端 API 设计模式 | `skills/backend-patterns/` |
| `frontend-patterns` | React/Next.js 模式 | `skills/frontend-patterns/` |
| `security-review` | 安全检查清单 | `skills/security-review/` |

#### 语言特定技能

| name | 描述 | 目录 |
|------|------|------|
| `python-patterns` | Python 惯用法/PEP 8 | `skills/python-patterns/` |
| `python-testing` | pytest 测试模式 | `skills/python-testing/` |
| `golang-patterns` | Go 惯用法 | `skills/golang-patterns/` |
| `golang-testing` | Go 测试/基准 | `skills/golang-testing/` |
| `java-coding-standards` | Java/JVM 最佳实践 | `skills/java-coding-standards/` |

#### 框架特定技能

| name | 描述 | 目录 |
|------|------|------|
| `django-patterns` | Django MVC 模式 | `skills/django-patterns/` |
| `django-security` | Django 安全 | `skills/django-security/` |
| `django-tdd` | Django TDD 工作流 | `skills/django-tdd/` |
| `django-verification` | Django 验证循环 | `skills/django-verification/` |
| `springboot-patterns` | Spring Boot 模式 | `skills/springboot-patterns/` |
| `springboot-security` | Spring Boot 安全 | `skills/springboot-security/` |
| `springboot-tdd` | Spring Boot TDD | `skills/springboot-tdd/` |
| `springboot-verification` | Spring Boot 验证 | `skills/springboot-verification/` |

#### 数据库技能

| name | 描述 | 目录 |
|------|------|------|
| `postgres-patterns` | PostgreSQL 优化模式 | `skills/postgres-patterns/` |
| `clickhouse-io` | ClickHouse 模式 | `skills/clickhouse-io/` |
| `jpa-patterns` | JPA/Hibernate 模式 | `skills/jpa-patterns/` |

#### 学习技能

| name | 描述 | 目录 |
|------|------|------|
| `continuous-learning` | v1 会话模式提取 | `skills/continuous-learning/` |
| `continuous-learning-v2` | v2 本能系统 | `skills/continuous-learning-v2/` |
| `iterative-retrieval` | 渐进式上下文精炼 | `skills/iterative-retrieval/` |

#### 配置技能

| name | 描述 | 目录 |
|------|------|------|
| `configure-ecc` | 交互式安装向导 | `skills/configure-ecc/` |
| `project-guidelines-example` | 项目指南模板 | `skills/project-guidelines-example/` |

---

## 6. 规则数据字典

### 6.1 规则目录结构

| 目录 | 必须安装 | 说明 |
|------|---------|------|
| `rules/common/` | ✅ 是 | 所有项目通用规则 |
| `rules/typescript/` | ❌ 按需 | TypeScript/JavaScript 项目 |
| `rules/python/` | ❌ 按需 | Python 项目 |
| `rules/golang/` | ❌ 按需 | Go 项目 |

### 6.2 通用规则清单

| 文件 | 内容概要 |
|------|---------|
| `common/coding-style.md` | 不可变性优先、文件组织、命名规范 |
| `common/git-workflow.md` | Conventional Commits、分支策略、PR 流程 |
| `common/testing.md` | TDD 要求、80% 覆盖率、测试命名 |
| `common/performance.md` | Token 优化、上下文管理、高效工具使用 |
| `common/patterns.md` | 设计模式、架构原则、代码组织 |
| `common/hooks.md` | 钩子架构说明、何时使用钩子 |
| `common/agents.md` | 代理委托策略、何时使用子代理 |
| `common/security.md` | 安全检查清单、敏感数据处理 |

### 6.3 语言特定规则清单

每种语言目录包含以下标准文件：

| 文件 | 内容概要 |
|------|---------|
| `coding-style.md` | 语言特定编码风格 |
| `hooks.md` | 语言特定钩子配置 |
| `patterns.md` | 语言惯用法和设计模式 |
| `security.md` | 语言特定安全注意事项 |
| `testing.md` | 语言特定测试框架和策略 |

---

## 7. 钩子数据字典

### 7.1 hooks.json 顶层结构

```json
{
  "hooks": {
    "<EventType>": [ <HookDefinition[]> ]
  }
}
```

### 7.2 HookDefinition 字段

| 字段名 | 数据类型 | 必填 | 默认值 | 说明 |
|--------|---------|------|--------|------|
| `matcher` | string | ❌ | — | 工具名过滤器，仅匹配该工具时触发 |
| `command` | string | ✅ | — | 要执行的 Shell 命令 |
| `timeout` | number | ❌ | 10000 | 超时时间（毫秒） |

### 7.3 事件类型枚举

| 事件类型 | 触发时机 | 输入 | 输出影响 |
|---------|---------|------|---------|
| `PreToolUse` | 工具执行前 | 工具名 + 参数 (stdin JSON) | stdout 非空 → 附加提示；"BLOCK" → 阻止 |
| `PostToolUse` | 工具执行后 | 工具名 + 结果 (stdin JSON) | stdout → 附加信息 |
| `SessionStart` | 会话开始时 | 无 | stdout → 初始上下文 |
| `PreCompact` | 上下文压缩前 | 压缩信息 (stdin JSON) | stdout → 保存的状态 |

### 7.4 当前钩子实例清单

| 事件 | matcher | 脚本 | 用途 |
|------|---------|------|------|
| SessionStart | — | `session-start.js` | 加载上下文、检测包管理器 |
| PreToolUse | Bash | (内联检查) | 阻止 tmux 外启动 dev server |
| PreToolUse | Bash | (内联检查) | 提醒长时命令使用 tmux |
| PreToolUse | Write | (内联检查) | 阻止意外创建 Markdown |
| PreToolUse | — | `suggest-compact.js` | 上下文压缩建议 |
| PreToolUse | Write/Edit | `check-console-log.js` | 检测 console.log |
| PostToolUse | — | (日志) | PR 创建日志 |
| PreCompact | — | `pre-compact.js` | 压缩前保存状态 |

---

## 8. 插件系统数据字典

### 8.1 plugin.json 结构

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|---------|------|------|
| `name` | string | ✅ | 插件名称 |
| `version` | string | ✅ | 语义化版本号 |
| `description` | string | ✅ | 插件描述 |
| `agents` | AgentRef[] | ❌ | 代理引用列表 |
| `skills` | SkillRef[] | ❌ | 技能引用列表 |
| `keywords` | string[] | ❌ | 搜索关键词 |

### 8.2 AgentRef / SkillRef 结构

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|---------|------|------|
| `name` | string | ✅ | 组件名称 |
| `path` | string | ✅ | 文件路径（相对于项目根） |

### 8.3 marketplace.json 结构

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|---------|------|------|
| `name` | string | ✅ | 包名 |
| `displayName` | string | ✅ | 展示名称 |
| `publisher` | string | ✅ | 发布者标识 |
| `version` | string | ✅ | 版本号 |
| `categories` | string[] | ❌ | 分类标签 |
| `installs` | number | ❌ | 安装次数 |
| `rating` | number | ❌ | 评分 (0-5) |

---

## 9. 会话数据字典

### 9.1 会话对象结构

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| `id` | string (UUID) | 会话唯一标识 |
| `alias` | string | 可选的可读别名 |
| `projectRoot` | string | 关联项目的根目录 |
| `created_at` | string (ISO 8601) | 创建时间 |
| `updated_at` | string (ISO 8601) | 最后更新时间 |
| `context` | SessionContext | 会话上下文数据 |

### 9.2 SessionContext 结构

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| `workingFiles` | string[] | 当前正在编辑的文件列表 |
| `recentCommands` | string[] | 最近使用的命令 |
| `activeInstincts` | string[] | 当前激活的本能 ID 列表 |
| `checkpoints` | Checkpoint[] | 保存的检查点列表 |

### 9.3 Checkpoint 结构

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| `id` | string | 检查点标识 |
| `timestamp` | string (ISO 8601) | 保存时间 |
| `summary` | string | 检查点摘要 |
| `verificationState` | object | 验证状态快照 |

---

## 10. 本能数据字典

### 10.1 本能（Instinct）对象

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| `id` | string | 本能唯一标识 |
| `pattern` | string | 模式描述（人类可读） |
| `confidence` | number (0.3-0.9) | 置信度评分 |
| `domain` | string | 领域标签 |
| `evidence` | Evidence[] | 支撑证据列表 |
| `created_at` | string (ISO 8601) | 首次创建时间 |
| `updated_at` | string (ISO 8601) | 最后更新时间 |

### 10.2 Evidence 结构

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| `source` | string | 来源会话 ID |
| `context` | string | 上下文描述 |

### 10.3 Domain 枚举

| 值 | 说明 | 示例 |
|----|------|------|
| `code-style` | 编码风格偏好 | 偏好 const over let |
| `testing` | 测试策略偏好 | 使用 describe/it 结构 |
| `git` | Git 工作流偏好 | 偏好 rebase over merge |
| `architecture` | 架构设计偏好 | 偏好函数式组件 |
| `security` | 安全实践偏好 | 总是检查 SQL 注入 |
| `performance` | 性能优化偏好 | 偏好懒加载 |
| `tooling` | 工具使用偏好 | 偏好 pnpm |
| `naming` | 命名惯例偏好 | 使用 camelCase |

### 10.4 置信度评分规则

| 范围 | 级别 | 含义 | 行为 |
|------|------|------|------|
| 0.3 | 初始 | 首次观察 | 记录，不自动应用 |
| 0.4-0.5 | 趋势 | 多次观察 | 记录，偶尔建议 |
| 0.6-0.7 | 可靠 | 多场景验证 | 主动建议应用 |
| 0.8-0.9 | 确定 | 高度可靠 | 自动应用 |

---

## 11. 包管理器配置数据字典

### 11.1 package-manager.json 结构

**项目级：** `.claude/package-manager.json`
**全局级：** `~/.claude/package-manager.json`

| 字段名 | 数据类型 | 说明 |
|--------|---------|------|
| `packageManager` | string | 项目级包管理器 |
| `default` | string | 全局默认包管理器 |

### 11.2 包管理器枚举

| 值 | 锁文件 | 安装命令 | 运行命令 |
|----|--------|---------|---------|
| `npm` | `package-lock.json` | `npm install` | `npm run <s>` |
| `pnpm` | `pnpm-lock.yaml` | `pnpm install` | `pnpm <s>` |
| `yarn` | `yarn.lock` | `yarn` | `yarn <s>` |
| `bun` | `bun.lockb` | `bun install` | `bun run <s>` |

---

## 12. MCP 服务器配置数据字典

### 12.1 mcp-servers.json 结构

```json
{
  "mcpServers": {
    "<server-name>": <MCPServerConfig>
  }
}
```

### 12.2 MCPServerConfig 字段

| 字段名 | 数据类型 | 必填 | 说明 |
|--------|---------|------|------|
| `command` | string | ✅ | 启动命令（如 `npx`） |
| `args` | string[] | ✅ | 命令参数 |
| `env` | object | ❌ | 环境变量（API Key 等） |

### 12.3 预配置 MCP 服务器清单

| 名称 | 命令 | 用途 | 所需环境变量 |
|------|------|------|-------------|
| `github` | `npx @modelcontextprotocol/server-github` | GitHub 操作 | `GITHUB_PERSONAL_ACCESS_TOKEN` |
| `supabase` | `npx @supabase/mcp-server` | 数据库 | `SUPABASE_PROJECT_REF`, `SUPABASE_SERVICE_ROLE_KEY` |
| `firecrawl` | `npx @anthropic/firecrawl-mcp-server` | Web 爬取 | `FIRECRAWL_API_KEY` |
| `memory` | `npx @modelcontextprotocol/server-memory` | 持久记忆 | — |
| `sequential-thinking` | `npx @modelcontextprotocol/server-sequential-thinking` | 链式推理 | — |
| `vercel` | `npx @vercel/mcp-server` | 部署 | Vercel 凭据 |
| `railway` | `npx @railway/mcp-server` | 部署 | `RAILWAY_API_KEY` |
| `cloudflare-workers` | `npx @cloudflare/mcp-server-workers` | Workers | Cloudflare 凭据 |
| `cloudflare-kv` | `npx @cloudflare/mcp-server-kv` | KV 存储 | Cloudflare 凭据 |
| `cloudflare-d1` | `npx @cloudflare/mcp-server-d1` | D1 数据库 | Cloudflare 凭据 |
| `cloudflare-r2` | `npx @cloudflare/mcp-server-r2` | R2 存储 | Cloudflare 凭据 |
